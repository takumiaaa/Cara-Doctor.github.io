<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <canvas id="paper_cv" width="400" height="400"></canvas>
  <script>
    var cv, ctx;
    window.onload = function () {
      // <canvas>を得る
      var cv = document.getElementById("paper_cv");
      // 描画用コンテキストを得る
      ctx = paper_cv.getContext("2d");
      // スマホかPCか判定
      if (can_use_touch()) {
        set_touch_event(cv);
      } else {
        set_mouse_event(cv);
      }
    };
    // タッチイベントがあるかどうかを調べる
    function can_use_touch() {
      var iframe = document.createElement('iframe');
      document.body.appendChild(iframe);
      var can_use = ('ontouchstart' in iframe.contentWindow);
      iframe.remove();
      return can_use;
    }
    // タッチ位置の正確な座標を求める
    function getClientPos(target, e) {
      var rect = target.getBoundingClientRect();
      var x = e.clientX - rect.left;
      var y = e.clientY - rect.top;
      return [x, y];
    }
    // タッチイベントを設定
    function set_touch_event(cv) {
      cv.ontouchstart = function (e) {
        var et = e.touches[0];
        pen_on_down(getClientPos(e.target, et));
        e.preventDefault();
      };
      cv.ontouchmove = function (e) {
        var et = e.touches[0];
        pen_on_move(getClientPos(e.target, et));
        e.preventDefault();
      };
      cv.ontouchend = function (e) {
        var et = e.touches[0];
        pen_on_up(getClientPos(e.target, et));
        e.preventDefault();
      };
    }
    // マウスイベントを設定
    function set_mouse_event(cv) {
      var is_down = false;
      cv.onmousedown = function (e) {
        is_down = true;
        pen_on_down(getClientPos(e.target, e));
        e.preventDefault();
      };
      cv.onmousemove = function (e) {
        if (!is_down) return;
        pen_on_move(getClientPos(e.target, e));
        e.preventDefault();
      };
      cv.onmouseup = function (e) {
        is_down = false;
        pen_on_up(getClientPos(e.target, e));
        e.preventDefault();
      };
    }
    // 線の開始点を指定
    function pen_on_down(p) {
      ctx.beginPath();
      ctx.lineWidth = 8;
      ctx.moveTo(p[0], p[1]);
    }
    // 線を描画する
    function pen_on_move(p) {
      ctx.lineTo(p[0], p[1]);
      ctx.stroke();
    }
    function pen_on_up(p) {
    }
  </script>

</body>

</html>
